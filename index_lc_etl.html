<style>
  .ttooltip {
    z-index: 99
  }

  .tooltip.container {
    width: 300px;
  }

  .tooltip.container img {
    float: left;
    max-width: 33%;
  }

  .tooltip.container ul {
    float: right;
    max-width: 66%;
    margin: 0
  }

  .tooltip.header {
    background-color: #ff7f64;
    padding: 5px;
    font-size: 0.85em;
  }

  .tooltip.title {
    font-size: 1.15em;
    font-weight: normal;
    padding: 5px 0 0 0;
    margin-bottom: 0;
  }

  .tooltip.date {
    font-variant: small-caps;
    color: #666;
    padding-bottom: 0.5em;
  }

</style>

<body>
  <h1>LC embedding ahoy.</h1>
  <div id="deepscatter" style="position:fixed;top:0;left:0">
  </div>
  <pre id="ident" style="z-index:99;position:fixed;"></pre>

</body>
<script src="https://d3js.org/d3.v7.min.js"></script>

<script type = "module">
  import Scatterplot from './src/deepscatter.js';
  import { select } from 'd3-selection';
  window.select = select; // For the click function below.
  const prefs = {
    "source_url" : "public/tiles",
    "max_points" : 5000,
    "alpha" : .7, // Target saturation for the full page.
    "zoom_balance" : 0.09, // Rate at which points increase size. https://observablehq.com/@bmschmidt/zoom-strategies-for-huge-scatterplots-with-three-js
    "point_size": 7, // Default point size before application of size scaling
    "background_color": "#dfe2e8",
    "encoding": {
      "color": {
        field: "collections",
        range: "category10",  // change this to get different color schemes, per https://observablehq.com/@d3/color-schemes
        domain: [-2047, 2047]
      },
      // labels/data/hover aren't working yet
      // "labels": ["collections", "title", "image_url", "date", "subjects", "url"],
      "x": {
        field: "x",
        transform: "literal"
      },
      "y": {
        field: "y",
        transform: "literal"
      }
    },
    "tooltip_html": (function(datum) {
      let img = `<img src="${datum["image_url"]}" alt="photograph of original document">`
      let header = `<div class="tooltip header">${datum["collections"].slice(2, -2)}</div>`
      let title = `<h3 class="tooltip title">${datum["title"]}</h3>`
      let date = `<div class="tooltip date">${datum["date"].getFullYear()} &mdash; <a href='${datum["url"]}'>original</a></span>`
      let description = `<div class="tooltip description">${datum['description']}</div>`
      let listdata = '';
      const labels = [
        "date", "subjects", "url"
      ]
      let subjects = JSON.parse(datum['subjects'].replace(/\'/g, '\"'))

      let subjects_html = ''
      for (const subj of subjects) {
        // Why is subj an Object and not a dict? Dunno.
        let key = Object.keys(subj)[0]
        subjects_html += `<li><a href="${subj[key].replace('fo=json', '')}">${key}</a></li>`
      }
      return `<div class="tooltip container">${header}${title}${date}<div>${description}${img}<ul>${subjects_html}</ul></div></div>`;
     })
  };

  const colors = [
    JSON.parse(JSON.stringify(prefs.encoding.color))
  ]

  const plot = new Scatterplot("#deepscatter")
  plot.plotAPI(prefs);
  window.plot = plot; // For debugging
</script>
